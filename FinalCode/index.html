<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>PhishGuard Ultimate | AI-Powered Cyber Defense</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --neon-cyan: #00f3ff;
            --neon-pink: #ff00ff;
            --neon-purple: #bc13fe;
            --neon-green: #0aff00;
            --neon-alert: #ff3333;
            --bg-dark: #050505;
            --glass-bg: rgba(10, 15, 25, 0.75);
            --glass-border: rgba(0, 243, 255, 0.1);
        }

        body {
            background-color: var(--bg-dark);
            color: #e0e0e0;
            font-family: 'Rajdhani', sans-serif;
            overflow-x: hidden;
            margin: 0;
        }

        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* --- ANIMATED BACKGROUND --- */
        .cyber-grid {
            position: fixed;
            top: 0; left: 0; width: 200%; height: 200%;
            background-image:
                linear-gradient(transparent 95%, rgba(0,243,255,0.03) 50%),
                linear-gradient(90deg, transparent 95%, rgba(0,243,255,0.03) 50%);
            background-size: 40px 40px;
            z-index: -1;
            animation: gridMove 60s linear infinite;
            transform: perspective(500px) rotateX(60deg) translateY(-100px) translateZ(-200px);
            mask-image: radial-gradient(circle at center, black 0%, transparent 80%);
        }

        @keyframes gridMove {
            0% { transform: perspective(500px) rotateX(60deg) translateY(0) translateZ(-200px); }
            100% { transform: perspective(500px) rotateX(60deg) translateY(40px) translateZ(-200px); }
        }

        /* --- UI ELEMENTS --- */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .glass-panel:hover {
            border-color: rgba(0, 243, 255, 0.3);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.1);
        }

        .glass-panel-highlight {
            border: 1px solid rgba(188, 19, 254, 0.3);
            box-shadow: 0 0 20px rgba(188, 19, 254, 0.1);
        }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #020202; }
        ::-webkit-scrollbar-thumb { background: #1f2937; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--neon-cyan); }

        /* --- ANIMATIONS --- */
        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }
        .scan-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, transparent, rgba(0,243,255,0.1), transparent);
            animation: scanline 4s linear infinite;
            pointer-events: none;
            z-index: 5;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px var(--neon-cyan); }
            50% { box-shadow: 0 0 20px var(--neon-cyan); }
        }
        .animate-pulse-glow { animation: pulse-glow 2s infinite; }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .ai-shimmer {
            background: linear-gradient(90deg, rgba(188,19,254,0.1) 25%, rgba(188,19,254,0.2) 50%, rgba(188,19,254,0.1) 75%);
            background-size: 200% 100%;
            animation: shimmer 3s infinite linear;
        }

        /* Chart Bars */
        .chart-bar { transition: height 1s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Markdown-like styling for AI */
        .ai-content h1, .ai-content h2 { color: var(--neon-pink); font-weight:bold; margin-top:0.5em; }
        .ai-content strong { color: white; }
        .ai-content ul { list-style: disc; padding-left: 1.5em; color: #d1d5db; }
        
        .nav-active {
            background: rgba(0, 243, 255, 0.1);
            border-left: 3px solid var(--neon-cyan);
            color: var(--neon-cyan);
        }
        .nav-inactive {
            border-left: 3px solid transparent;
            color: #6b7280;
        }
        .nav-inactive:hover {
            background: rgba(255, 255, 255, 0.03);
            color: #e5e7eb;
        }

        /* Print-friendly report */
        @media print {
            body { background: white; color: black; }
            .cyber-grid, header, aside, .scan-overlay, .ai-shimmer, .glass-panel:hover { display: none !important; }
            .glass-panel, .glass-panel * { background: transparent !important; box-shadow: none !important; color: black !important; }
            .no-print { display: none !important; }
        }

        /* Accessibility / High-contrast mode */
        .a11y-mode {
            --neon-cyan: #00ff00 !important;
            --neon-pink: #ffffff !important;
            --neon-purple: #ffffff !important;
            --neon-green: #00ff00 !important;
            --neon-alert: #ff0000 !important;
            --bg-dark: #000000 !important;
            backdrop-filter: none !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // ==========================================
        // 1. CONFIGURATION & API KEYS
        // ==========================================
        // NOTE: API Key is injected by environment. 
        // If running locally, replace with your own key or leave empty for mock fallback (if implemented).
        const GEMINI_API_KEY = ""; 

        // ==========================================
        // 2. ROBUST ICON SYSTEM (Inline SVGs)
        // ==========================================
        // We define icons manually to prevent CDN crashes (Black Screen Fix)
        const Icon = ({ children, size=20, className='', ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                {children}
            </svg>
        );

        const Icons = {
            Shield: (p) => <Icon {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></Icon>,
            ShieldAlert: (p) => <Icon {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></Icon>,
            ShieldCheck: (p) => <Icon {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M9 12l2 2 4-4"/></Icon>,
            Search: (p) => <Icon {...p}><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></Icon>,
            Activity: (p) => <Icon {...p}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></Icon>,
            Terminal: (p) => <Icon {...p}><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></Icon>,
            Server: (p) => <Icon {...p}><rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></Icon>,
            MapPin: (p) => <Icon {...p}><path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></Icon>,
            AlertTriangle: (p) => <Icon {...p}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></Icon>,
            Clock: (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></Icon>,
            Globe: (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></Icon>,
            Lock: (p) => <Icon {...p}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></Icon>,
            Volume2: (p) => <Icon {...p}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></Icon>,
            VolumeX: (p) => <Icon {...p}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></Icon>,
            ChevronRight: (p) => <Icon {...p}><polyline points="9 18 15 12 9 6"/></Icon>,
            Download: (p) => <Icon {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></Icon>,
            X: (p) => <Icon {...p}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></Icon>,
            FileText: (p) => <Icon {...p}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></Icon>,
            BarChart3: (p) => <Icon {...p}><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></Icon>,
            Upload: (p) => <Icon {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></Icon>,
            Copy: (p) => <Icon {...p}><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></Icon>,
            ExternalLink: (p) => <Icon {...p}><path d="M18 13v6a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></Icon>,
            Trash2: (p) => <Icon {...p}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></Icon>,
            RefreshCw: (p) => <Icon {...p}><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></Icon>,
            Sparkles: (p) => <Icon {...p}><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/></Icon>,
            Bot: (p) => <Icon {...p}><rect x="3" y="11" width="18" height="10" rx="2"/><circle cx="12" cy="5" r="2"/><path d="M12 7v4"/><line x1="8" y1="16" x2="8" y2="16"/><line x1="16" y1="16" x2="16" y2="16"/></Icon>,
            MessageSquare: (p) => <Icon {...p}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></Icon>,
            Send: (p) => <Icon {...p}><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></Icon>,
            Mail: (p) => <Icon {...p}><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></Icon>
        };

        // ==========================================
        // 3. SOUND ENGINE (Oscillator Based) + Mixer
        // ==========================================
        const SoundEngine = {
            ctx: null,
            enabled: true,
            muted: { click: false, alert: false, ai: false, hover: false },
            init() {
                if (!this.ctx && (window.AudioContext || window.webkitAudioContext)) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                }
            },
            setMuted(category, value) {
                this.muted[category] = !!value;
            },
            play(type) {
                if (!this.enabled || !this.ctx) return;
                if (this.muted[type]) return;
                const t = this.ctx.currentTime;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain);
                gain.connect(this.ctx.destination);

                if (type === 'hover') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(400, t);
                    osc.frequency.linearRampToValueAtTime(600, t + 0.05);
                    gain.gain.setValueAtTime(0.02, t);
                    gain.gain.linearRampToValueAtTime(0, t + 0.05);
                    osc.start(t); osc.stop(t + 0.05);
                } else if (type === 'click') {
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(800, t);
                    osc.frequency.exponentialRampToValueAtTime(400, t + 0.1);
                    gain.gain.setValueAtTime(0.05, t);
                    gain.gain.exponentialRampToValueAtTime(0.01, t + 0.1);
                    osc.start(t); osc.stop(t + 0.1);
                } else if (type === 'scan') {
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(200, t);
                    osc.frequency.linearRampToValueAtTime(800, t + 0.5);
                    gain.gain.setValueAtTime(0.05, t);
                    gain.gain.linearRampToValueAtTime(0, t + 0.5);
                    osc.start(t); osc.stop(t + 0.5);
                } else if (type === 'alert') {
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(200, t);
                    osc.frequency.linearRampToValueAtTime(150, t + 0.1);
                    osc.frequency.linearRampToValueAtTime(200, t + 0.2);
                    gain.gain.setValueAtTime(0.1, t);
                    gain.gain.linearRampToValueAtTime(0, t + 0.4);
                    osc.start(t); osc.stop(t + 0.4);
                } else if (type === 'ai') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(1200, t);
                    osc.frequency.linearRampToValueAtTime(1800, t + 0.3);
                    gain.gain.setValueAtTime(0.01, t);
                    gain.gain.linearRampToValueAtTime(0.03, t + 0.1);
                    gain.gain.linearRampToValueAtTime(0, t + 0.3);
                    osc.start(t); osc.stop(t + 0.3);
                }
            }
        };

        // ==========================================
        // 4. SERVICE LAYERS (Gemini + Logic)
        // ==========================================
        
        const callGemini = async (prompt) => {
            try {
                if (!GEMINI_API_KEY) {
                    // Simulated delay for demo without API key
                    await new Promise(r => setTimeout(r, 1500));
                    return "Gemini API Key is missing in configuration. Please configure the API key to enable Generative AI features.\n\nSimulated Insight: The URL appears to host a phishing kit mimicking a banking login. High-risk indicators found in DOM structure.";
                }

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });

                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "AI Analysis unavailable.";
            } catch (error) {
                console.error("Gemini API Failed:", error);
                return "Unable to connect to Sentinel AI Grid. Please verify network connection.";
            }
        };

        // Utilities
        const levenshteinDistance = (a, b) => {
            const matrix = [];
            for (let i = 0; i <= b.length; i++) { matrix[i] = [i]; }
            for (let j = 0; j <= a.length; j++) { matrix[0][j] = j; }
            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) == a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, Math.min(matrix[i][j - 1] + 1, matrix[i - 1][j] + 1));
                    }
                }
            }
            return matrix[b.length][a.length];
        };

        const PROTECTED_BRANDS = ['google.com', 'paypal.com', 'microsoft.com', 'apple.com', 'facebook.com', 'amazon.com', 'netflix.com', 'bankofamerica.com', 'chase.com', 'wellsfargo.com'];

        const normalizeUrl = (input) => {
            try {
                let urlStr = input.trim();
                if (!/^https?:\/\//i.test(urlStr)) urlStr = 'http://' + urlStr;
                const url = new URL(urlStr);
                const trackingParams = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content', 'fbclid', 'gclid'];
                trackingParams.forEach(p => url.searchParams.delete(p));
                return { valid: true, normalized: url.toString(), hostname: url.hostname, protocol: url.protocol };
            } catch (e) { return { valid: false, error: 'Invalid URL format' }; }
        };

        // Allow / Block list utilities
        const Lists = {
            getAllow() { try { return JSON.parse(localStorage.getItem('phishguard_allowlist') || '[]'); } catch(e){return [];} },
            getBlock() { try { return JSON.parse(localStorage.getItem('phishguard_blocklist') || '[]'); } catch(e){return [];} },
            addAllow(item) { const cur = Lists.getAllow(); cur.unshift(item); localStorage.setItem('phishguard_allowlist', JSON.stringify([...new Set(cur)].slice(0,200))); },
            addBlock(item) { const cur = Lists.getBlock(); cur.unshift(item); localStorage.setItem('phishguard_blocklist', JSON.stringify([...new Set(cur)].slice(0,200))); },
            removeAllow(item) { const cur = Lists.getAllow().filter(x=>x!==item); localStorage.setItem('phishguard_allowlist', JSON.stringify(cur)); },
            removeBlock(item) { const cur = Lists.getBlock().filter(x=>x!==item); localStorage.setItem('phishguard_blocklist', JSON.stringify(cur)); }
        };

        // Core Engine
        const PhishGuardService = {
            async analyze(urlStr) {
                await new Promise(r => setTimeout(r, 1000)); // Simulated scanning delay
                const { hostname, protocol } = normalizeUrl(urlStr);
                const isp = ['Cloudflare, Inc.','OVH SAS','DigitalOcean, LLC','Amazon.com, Inc.','Google LLC'][Math.floor(Math.random()*5)];
                const isHttp = protocol === 'http:';
                const riskKeywords = ['login', 'secure', 'account', 'update', 'verify', 'wallet', 'free', 'bonus', 'confirm', 'billing'];
                const hasRiskKeyword = riskKeywords.some(k => urlStr.toLowerCase().includes(k));
                
                let similarityWarning = null;
                const cleanHost = hostname.replace('www.', '');
                PROTECTED_BRANDS.forEach(brand => {
                    if (cleanHost !== brand) {
                        const dist = levenshteinDistance(cleanHost, brand);
                        if (dist > 0 && dist <= 3) similarityWarning = `Typosquatting detected! Resembles: ${brand}`;
                    }
                });

                let score = 10; // Start low risk
                if (isHttp) score += 25;
                if (hasRiskKeyword) score += 30;
                if (similarityWarning) score += 40;
                score += Math.floor(Math.random() * 15);
                score = Math.min(score, 99);

                // Threat Level Logic
                let threatLevel = 'SAFE';
                if (score > 45) threatLevel = 'MODERATE';
                if (score > 75) threatLevel = 'CRITICAL';

                return {
                    id: crypto.randomUUID(),
                    url: urlStr,
                    hostname,
                    timestamp: new Date().toISOString(),
                    score,
                    threatLevel,
                    similarityWarning,
                    vendorResults: {
                        virusTotal: score > 60 ? 'Suspicious' : 'Clean',
                        googleSafeBrowsing: score > 80 ? 'Unsafe' : 'Safe',
                        phishTank: score > 70 ? 'Valid Phish' : 'Unknown'
                    },
                    geo: { 
                        ip: `192.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`, 
                        country: ['US', 'CN', 'RU', 'BR', 'DE', 'IN'][Math.floor(Math.random() * 6)], 
                        asn: `AS${Math.floor(Math.random() * 90000)}` ,
                        isp
                    },
                    ssl: { 
                        valid: !isHttp, 
                        issuer: isHttp ? null : "Let's Encrypt Authority X3", 
                        expires: isHttp ? null : '2025-12-31' 
                    },
                    dns: { a: '1.1.1.1', mx: 'mx.zoho.com' },
                    whois: { registrar: 'NameCheap, Inc.', ageDays: Math.floor(Math.random() * 2000) },
                    logs: [
                        '> Initializing handshake...',
                        '> Resolving DNS...',
                        '> Querying global blacklists (VirusTotal, Google SB)...',
                        '> Analyzing SSL certificate chain...',
                        `> Traceroute complete: ${Math.floor(Math.random() * 50)}ms latency`,
                        '> Heuristic engine: Pattern matching active...',
                        '> SCAN COMPLETE.'
                    ]
                };
            }
        };

        // ==========================================
        // 5. REACT COMPONENTS (UI)
        // ==========================================

        // Error Boundary
        class ErrorBoundary extends React.Component {
            state = { hasError: false, error: null };
            static getDerivedStateFromError(error) { return { hasError: true, error }; }
            render() {
                if (this.state.hasError) return (
                    <div className="min-h-screen flex items-center justify-center bg-black text-red-500 font-mono p-10 border-4 border-red-900">
                        <div>
                            <h1 className="text-4xl font-bold mb-4">SYSTEM CRITICAL FAILURE</h1>
                            <p>{this.state.error?.toString()}</p>
                            <button onClick={() => window.location.reload()} className="mt-8 border border-red-500 px-6 py-2 hover:bg-red-900/50">REBOOT SYSTEM</button>
                        </div>
                    </div>
                );
                return this.props.children;
            }
        }

        const NavItem = ({ icon: IconComp, label, active, onClick }) => (
            <button 
                onClick={onClick}
                className={`flex items-center gap-3 px-4 py-3 w-full transition-all duration-300 ${active ? 'nav-active' : 'nav-inactive'}`}
            >
                <IconComp size={20} />
                <span className="font-medium tracking-wide text-sm hidden md:inline">{label}</span>
            </button>
        );

        const Badge = ({ type }) => {
            const colors = {
                'CRITICAL': 'bg-red-500/20 text-red-400 border-red-500 shadow-[0_0_10px_rgba(239,68,68,0.4)]',
                'MODERATE': 'bg-yellow-500/20 text-yellow-400 border-yellow-500 shadow-[0_0_10px_rgba(234,179,8,0.4)]',
                'SAFE': 'bg-green-500/20 text-green-400 border-green-500 shadow-[0_0_10px_rgba(34,197,94,0.4)]'
            };
            return <span className={`px-4 py-1 rounded text-xs font-bold border tracking-wider animate-pulse-glow ${colors[type] || colors['SAFE']}`}>{type}</span>;
        };

        const TerminalLog = ({ logs }) => {
            const bottomRef = useRef(null);
            useEffect(() => bottomRef.current?.scrollIntoView({ behavior: 'smooth' }), [logs]);
            return (
                <div className="glass-panel rounded-lg p-4 h-48 overflow-y-auto font-mono text-xs border-l-4 border-l-cyan-500 bg-black/60">
                    <div className="flex items-center gap-2 mb-2 text-cyan-400 border-b border-gray-800 pb-1 sticky top-0 bg-black/80 backdrop-blur-sm">
                        <Icons.Terminal size={14} />
                        <span className="uppercase tracking-widest">System Kernel Logs</span>
                    </div>
                    {logs.map((log, i) => (
                        <div key={i} className="mb-1 animate-pulse">
                            <span className="text-gray-500">[{new Date().toLocaleTimeString()}]</span> <span className="text-green-400">{log}</span>
                        </div>
                    ))}
                    <div ref={bottomRef} />
                </div>
            );
        };

        // --- SUB-SCREENS ---

        const ScannerHome = ({ onScan, searchRef }) => {
            const [url, setUrl] = useState('');
            return (
                <div className="flex flex-col items-center justify-center h-full px-4 animate-fade-in">
                    <div className="mb-12 text-center">
                        <div className="inline-block p-4 rounded-full bg-cyan-500/10 border border-cyan-500/30 mb-6 animate-pulse-glow">
                            <Icons.Shield size={64} className="text-cyan-400" />
                        </div>
                        <h1 className="text-5xl md:text-7xl font-bold text-white mb-4 tracking-tighter">
                            PHISH<span className="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-600">GUARD</span>
                        </h1>
                        <p className="text-gray-400 text-lg max-w-xl mx-auto font-mono">
                            AI-Powered Threat Intelligence Platform.
                            <br/>Detects phishing, typosquatting, and malicious infrastructure.
                        </p>
                    </div>

                    <div className="w-full max-w-2xl relative group z-20">
                         <div className="absolute -inset-1 bg-gradient-to-r from-cyan-400 to-purple-600 rounded-lg blur opacity-30 group-hover:opacity-60 transition duration-1000"></div>
                         <div className="relative flex bg-black/90 rounded-lg border border-gray-700 group-focus-within:border-cyan-500 transition-colors p-2 items-center">
                            <Icons.Search className="ml-3 text-gray-500" />
                            <input 
                                ref={searchRef}
                                className="w-full bg-transparent border-none text-white px-4 py-3 focus:outline-none font-mono text-lg placeholder-gray-600" 
                                placeholder="ENTER TARGET URL (e.g. secure-login-paypal.com)" 
                                value={url} 
                                onChange={e=>setUrl(e.target.value)} 
                                onKeyDown={e=>e.key==='Enter'&&onScan(url)}
                            />
                            <button 
                                onClick={()=>onScan(url)} 
                                className="bg-cyan-900/80 hover:bg-cyan-500 hover:text-black text-cyan-400 px-8 py-3 rounded font-bold transition-all border border-cyan-800 hover:border-cyan-400 tracking-widest"
                            >
                                SCAN
                            </button>
                         </div>
                    </div>
                </div>
            );
        };

        const ResultDetail = ({ data, onBack }) => {
            const [aiReport, setAiReport] = useState(null);
            const [isGeneratingAI, setIsGeneratingAI] = useState(false);

            const generateAiReport = async () => {
                setIsGeneratingAI(true);
                SoundEngine.play('ai');
                const prompt = `Act as a Senior Cybersecurity Analyst. Write a concise executive summary for this URL scan. 
                URL: ${data.url}
                Score: ${data.score}/100 (Higher is safer)
                Threat Level: ${data.threatLevel}
                Host Country: ${data.geo.country}
                SSL: ${data.ssl.valid ? 'Valid' : 'Invalid'}
                WHOIS Age: ${data.whois.ageDays} days
                Similar Brand: ${data.similarityWarning || 'None'}
                Explain why this site is risky or safe based on these metrics. Keep it under 80 words.`;
                
                const report = await callGemini(prompt);
                setAiReport(report);
                setIsGeneratingAI(false);
            };

            return (
                <div className="p-6 max-w-7xl mx-auto pb-24 animate-fade-in">
                    <button onClick={onBack} className="text-gray-500 hover:text-white mb-6 flex items-center gap-2 text-sm transition-colors">
                        <Icons.ChevronRight className="rotate-180" size={16}/> RETURN TO SCANNER
                    </button>

                    {/* Top Header */}
                    <div className="glass-panel p-8 rounded-xl border-l-4 border-cyan-500 mb-8 relative overflow-hidden">
                        <div className="scan-overlay"></div>
                        <div className="flex flex-col md:flex-row justify-between md:items-center gap-6 relative z-10">
                            <div>
                                <div className="flex items-center gap-3 mb-2">
                                    <Icons.Globe className="text-cyan-400" size={20}/>
                                    <h2 className="text-3xl font-bold text-white font-mono break-all tracking-tight">{data.url}</h2>
                                </div>
                                <div className="flex flex-wrap gap-6 text-sm text-gray-400 font-mono">
                                    <span className="flex items-center gap-2"><Icons.Clock size={14}/> {new Date(data.timestamp).toLocaleTimeString()}</span>
                                    <span className="flex items-center gap-2"><Icons.Server size={14}/> {data.geo.ip}</span>
                                    <span className="flex items-center gap-2"><Icons.MapPin size={14}/> {data.geo.country}</span>
                                    <span className="flex items-center gap-2"><Icons.Server size={14}/> {data.geo.isp}</span>
                                </div>
                            </div>
                            <div className="flex items-center gap-6 bg-black/40 p-4 rounded-lg border border-gray-800">
                                <div className="text-right">
                                    <div className="text-5xl font-bold text-white font-mono">{data.score}</div>
                                    <div className="text-xs text-gray-500 uppercase tracking-wider">Safety Score</div>
                                </div>
                                <Badge type={data.threatLevel} />
                                <button onClick={()=>window.print()} className="ml-2 text-xs px-3 py-1 border rounded bg-black/20">Print Report</button>
                            </div>
                        </div>
                    </div>

                    {/* AI Insight Block */}
                    <div className="mb-8">
                        {!aiReport ? (
                            <button 
                                onClick={generateAiReport}
                                disabled={isGeneratingAI}
                                className="w-full py-6 glass-panel glass-panel-highlight rounded-xl flex items-center justify-center gap-3 text-fuchsia-400 hover:bg-fuchsia-900/20 transition-all group"
                            >
                                {isGeneratingAI ? <Icons.RefreshCw className="animate-spin"/> : <Icons.Sparkles className="text-yellow-300 group-hover:animate-bounce"/>}
                                <span className="font-bold tracking-widest">{isGeneratingAI ? 'SENTINEL AI IS ANALYZING...' : 'GENERATE AI THREAT INSIGHT'}</span>
                            </button>
                        ) : (
                            <div className="glass-panel glass-panel-highlight p-6 rounded-xl relative overflow-hidden ai-shimmer">
                                <div className="relative z-10">
                                    <h3 className="text-fuchsia-400 font-bold mb-3 flex items-center gap-2 text-lg"><Icons.Bot size={20}/> SENTINEL AI INSIGHT</h3>
                                    <div className="text-gray-200 leading-relaxed ai-content text-lg font-light">{aiReport}</div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Details Grid */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        {/* Left Column */}
                        <div className="space-y-6">
                            <div className="glass-panel p-6 rounded-xl">
                                <h3 className="text-cyan-400 font-bold text-sm mb-4 flex items-center gap-2 tracking-widest"><Icons.ShieldCheck size={16}/> VENDOR REPUTATION</h3>
                                <div className="space-y-3">
                                    {Object.entries(data.vendorResults).map(([vendor, status]) => (
                                        <div key={vendor} className="flex justify-between items-center border-b border-gray-800 pb-2 last:border-0">
                                            <span className="capitalize text-gray-300 font-mono text-sm">{vendor.replace(/([A-Z])/g, ' $1')}</span>
                                            <span className={`text-xs font-bold px-2 py-0.5 rounded ${status === 'Safe' || status === 'Clean' ? 'bg-green-900/30 text-green-400' : 'bg-red-900/30 text-red-400'}`}>{status}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="glass-panel p-6 rounded-xl">
                                <h3 className="text-white font-bold text-sm mb-4 flex items-center gap-2 tracking-widest"><Icons.Lock size={16}/> SSL CONFIGURATION</h3>
                                <div className="space-y-3 text-sm font-mono">
                                    <div className="flex justify-between"><span className="text-gray-500">Valid</span> <span className={data.ssl.valid ? 'text-green-400' : 'text-red-400'}>{data.ssl.valid ? 'Yes' : 'No'}</span></div>
                                    <div className="flex justify-between"><span className="text-gray-500">Issuer</span> <span className="text-white text-right">{data.ssl.issuer || 'N/A'}</span></div>
                                    <div className="flex justify-between"><span className="text-gray-500">Expires</span> <span className="text-white">{data.ssl.expires || 'N/A'}</span></div>
                                </div>
                            </div>
                        </div>

                        {/* Middle/Right Column */}
                        <div className="lg:col-span-2 space-y-6">
                            {data.similarityWarning && (
                                <div className="bg-red-500/10 border border-red-500 p-4 rounded-xl flex items-start gap-4 animate-pulse-glow">
                                    <Icons.AlertTriangle className="text-red-500 shrink-0" size={24}/>
                                    <div>
                                        <h4 className="font-bold text-red-400 text-lg">Homograph Attack Detected</h4>
                                        <p className="text-gray-300">{data.similarityWarning}</p>
                                    </div>
                                </div>
                            )}

                            <div className="glass-panel p-6 rounded-xl">
                                <h3 className="text-white font-bold mb-4 tracking-widest">NETWORK INTELLIGENCE</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="bg-black/40 p-4 rounded border border-gray-800"><div className="text-xs text-gray-500 mb-1">ASN/ISP</div><div className="text-cyan-300 font-mono text-lg">{data.geo.asn}</div></div>
                                    <div className="bg-black/40 p-4 rounded border border-gray-800"><div className="text-xs text-gray-500 mb-1">LOCATION</div><div className="text-cyan-300 font-mono text-lg">{data.geo.country}</div></div>
                                    <div className="bg-black/40 p-4 rounded border border-gray-800"><div className="text-xs text-gray-500 mb-1">REGISTRAR</div><div className="text-white font-mono text-lg">{data.whois.registrar}</div></div>
                                    <div className="bg-black/40 p-4 rounded border border-gray-800"><div className="text-xs text-gray-500 mb-1">DOMAIN AGE</div><div className="text-white font-mono text-lg">{data.whois.ageDays} Days</div></div>
                                </div>
                            </div>

                            <TerminalLog logs={data.logs}/>
                        </div>
                    </div>
                </div>
            );
        };

        const EmailAnalyzer = () => {
            const [subject, setSubject] = useState('');
            const [body, setBody] = useState('');
            const [analysis, setAnalysis] = useState(null);
            const [isAnalyzing, setIsAnalyzing] = useState(false);

            const analyzeEmail = async () => {
                if (!body.trim()) return;
                setIsAnalyzing(true);
                SoundEngine.play('ai');
                
                const prompt = `Analyze this potentially malicious email for phishing indicators. Look for urgency, authority, scarcity, suspicious links, and grammatical errors.
                Subject: "${subject}"
                Body: "${body}"
                Provide a response in JSON format with keys: "riskLevel" (Low/Medium/High/Critical), "score" (0-100), "summary" (concise explanation), and "indicators" (array of strings).`;

                const rawText = await callGemini(prompt);
                
                // Mock parsing for resilience if AI returns markdown
                let result = { riskLevel: 'Unknown', score: 0, summary: rawText, indicators: [] };
                try {
                    const jsonMatch = rawText.match(/\{[\s\S]*\}/);
                    if (jsonMatch) result = JSON.parse(jsonMatch[0]);
                } catch (e) {}

                setAnalysis(result);
                setIsAnalyzing(false);
            };

            return (
                <div className="p-6 max-w-5xl mx-auto pb-24 animate-fade-in">
                    <h2 className="text-3xl font-bold text-white mb-2 flex items-center gap-3">
                        <Icons.Mail className="text-fuchsia-400" size={32}/> PHISHING EMAIL ANALYZER
                    </h2>
                    <p className="text-gray-400 mb-8 text-lg">Sentinel AI will analyze email rhetoric for social engineering tactics.</p>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div className="space-y-4">
                            <div className="glass-panel p-4 rounded-lg">
                                <label className="block text-xs text-gray-500 mb-2 font-bold tracking-widest">SUBJECT LINE</label>
                                <input 
                                    className="w-full bg-black/50 border border-gray-700 rounded p-3 text-white focus:border-fuchsia-400 focus:outline-none transition-colors"
                                    placeholder="e.g. URGENT: Account Suspension Notice"
                                    value={subject}
                                    onChange={(e) => setSubject(e.target.value)}
                                />
                            </div>
                            <div className="glass-panel p-4 rounded-lg">
                                <label className="block text-xs text-gray-500 mb-2 font-bold tracking-widest">EMAIL BODY</label>
                                <textarea 
                                    className="w-full h-80 bg-black/50 border border-gray-700 rounded p-3 text-white focus:border-fuchsia-400 focus:outline-none resize-none transition-colors"
                                    placeholder="Paste the full email content here..."
                                    value={body}
                                    onChange={(e) => setBody(e.target.value)}
                                />
                            </div>
                            <button 
                                onClick={analyzeEmail}
                                disabled={isAnalyzing || !body}
                                className="w-full py-4 bg-fuchsia-700 hover:bg-fuchsia-600 text-white font-bold rounded flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-[0_0_15px_rgba(162,28,175,0.4)]"
                            >
                                {isAnalyzing ? <Icons.RefreshCw className="animate-spin"/> : <Icons.Sparkles className="text-yellow-300"/>}
                                {isAnalyzing ? 'ANALYZING RHETORIC...' : 'ANALYZE EMAIL'}
                            </button>
                        </div>

                        <div className="relative">
                            {analysis ? (
                                <div className="glass-panel glass-panel-highlight p-8 rounded-lg h-full animate-fade-in">
                                    <div className="flex justify-between items-start mb-6 border-b border-gray-800 pb-6">
                                        <div>
                                            <div className="text-xs text-gray-400 uppercase tracking-widest mb-1">Threat Assessment</div>
                                            <div className={`text-4xl font-bold tracking-tighter ${analysis.riskLevel === 'Critical' || analysis.riskLevel === 'High' ? 'text-red-500' : 'text-green-500'}`}>
                                                {analysis.riskLevel?.toUpperCase() || "ANALYZED"}
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-4xl font-mono text-white font-bold">{analysis.score}/100</div>
                                            <div className="text-xs text-gray-500 uppercase">Confidence</div>
                                        </div>
                                    </div>
                                    
                                    <div className="mb-8">
                                        <div className="text-xs text-fuchsia-400 font-bold mb-3 flex items-center gap-2"><Icons.Bot size={16}/> ANALYSIS SUMMARY</div>
                                        <p className="text-gray-300 leading-relaxed text-lg">{analysis.summary}</p>
                                    </div>

                                    {analysis.indicators && analysis.indicators.length > 0 && (
                                        <div>
                                            <div className="text-xs text-gray-500 mb-3 uppercase font-bold">Detected Indicators</div>
                                            <div className="space-y-3">
                                                {analysis.indicators.map((ind, i) => (
                                                    <div key={i} className="bg-red-900/20 border-l-4 border-red-500 p-3 text-sm text-red-200">
                                                        {ind}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            ) : (
                                <div className="glass-panel p-8 rounded-lg h-full flex flex-col items-center justify-center text-gray-600 border-dashed border-gray-800 bg-black/20">
                                    <Icons.Bot size={64} className="mb-6 opacity-20 animate-pulse"/>
                                    <p className="text-lg text-center max-w-xs">Ready to analyze. Results generated by Sentinel AI will appear here.</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const BatchScanner = ({ onScanComplete }) => {
            const [input, setInput] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);
            const [progress, setProgress] = useState(0);
            const [logs, setLogs] = useState([]);

            const processBatch = async () => {
                if (!input.trim()) return;
                setIsProcessing(true);
                setProgress(0);
                setLogs([]);
                const urls = input.split(/[\n,]+/).map(u => u.trim()).filter(Boolean);
                const total = urls.length;
                
                for (let i = 0; i < total; i++) {
                    const raw = urls[i];
                    setLogs(prev => [`Processing ${raw}...`, ...prev]);
                    const norm = normalizeUrl(raw);
                    if (norm.valid) {
                        const result = await PhishGuardService.analyze(norm.normalized);
                        onScanComplete(result);
                    }
                    setProgress(Math.round(((i+1)/total)*100));
                }
                setIsProcessing(false);
                setLogs(prev => [`Batch Complete. Processed ${total} URLs.`, ...prev]);
            };

            return (
                <div className="p-6 max-w-5xl mx-auto animate-fade-in">
                    <h2 className="text-2xl font-bold text-white mb-6 flex items-center gap-2"><Icons.FileText size={24} className="text-cyan-400"/> BATCH PROCESSING</h2>
                    <div className="glass-panel p-6 rounded-lg mb-6">
                        <div className="flex justify-between mb-2">
                            <label className="text-gray-400 text-sm font-bold tracking-widest">URL LIST (One per line)</label>
                        </div>
                        <textarea className="w-full h-48 bg-black/50 border border-gray-700 rounded p-4 text-white font-mono text-sm focus:border-cyan-400 focus:outline-none transition-colors mb-4" placeholder="google.com&#10;suspicious-site.net&#10;paypal-verify.com" value={input} onChange={e => setInput(e.target.value)} disabled={isProcessing}/>
                        
                        <button onClick={processBatch} disabled={isProcessing || !input} className={`w-full py-4 rounded font-bold tracking-wider flex items-center justify-center gap-3 transition-all ${isProcessing ? 'bg-gray-800 text-gray-500 cursor-not-allowed' : 'bg-cyan-600 hover:bg-cyan-500 text-black'}`}>
                            {isProcessing ? <Icons.RefreshCw className="animate-spin" /> : <Icons.Activity/>}
                            {isProcessing ? `PROCESSING BATCH... ${progress}%` : 'START BATCH OPERATION'}
                        </button>
                        
                        {isProcessing && (
                            <div className="mt-4 h-2 bg-gray-800 rounded-full overflow-hidden">
                                <div className="h-full bg-cyan-400 transition-all duration-300" style={{width: `${progress}%`}}/>
                            </div>
                        )}
                    </div>
                    {logs.length > 0 && <TerminalLog logs={logs} />}
                </div>
            );
        };

        const AnalyticsDashboard = ({ history }) => {
            const stats = useMemo(() => {
                const total = history.length;
                const critical = history.filter(h => h.threatLevel === 'CRITICAL').length;
                const moderate = history.filter(h => h.threatLevel === 'MODERATE').length;
                const safe = history.filter(h => h.threatLevel === 'SAFE').length;
                return { total, critical, moderate, safe };
            }, [history]);

            if (history.length === 0) return (
                <div className="flex flex-col items-center justify-center h-full text-gray-500 opacity-50 p-10">
                    <Icons.BarChart3 size={80} className="mb-6"/>
                    <p className="text-xl">No data available. Run scans to generate analytics.</p>
                </div>
            );

            return (
                <div className="p-6 max-w-7xl mx-auto animate-fade-in">
                    <h2 className="text-2xl font-bold text-white mb-6 border-b border-gray-800 pb-4">THREAT INTELLIGENCE DASHBOARD</h2>
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div className="glass-panel p-6 rounded-xl">
                            <div className="text-gray-400 text-xs uppercase tracking-widest mb-2">Total Scans</div>
                            <div className="text-4xl text-white font-mono font-bold">{stats.total}</div>
                        </div>
                        <div className="glass-panel p-6 rounded-xl border-red-900/50">
                            <div className="text-red-400 text-xs uppercase tracking-widest mb-2">Critical Threats</div>
                            <div className="text-4xl text-red-500 font-mono font-bold">{stats.critical}</div>
                        </div>
                        <div className="glass-panel p-6 rounded-xl border-yellow-900/50">
                            <div className="text-yellow-400 text-xs uppercase tracking-widest mb-2">Moderate Risks</div>
                            <div className="text-4xl text-yellow-500 font-mono font-bold">{stats.moderate}</div>
                        </div>
                        <div className="glass-panel p-6 rounded-xl border-green-900/50">
                            <div className="text-green-400 text-xs uppercase tracking-widest mb-2">Safe Domains</div>
                            <div className="text-4xl text-green-500 font-mono font-bold">{stats.safe}</div>
                        </div>
                    </div>
                    
                    <div className="glass-panel p-8 rounded-xl">
                        <h3 className="text-cyan-400 text-sm font-bold mb-8 flex items-center gap-2 tracking-widest"><Icons.Activity size={16}/> THREAT DISTRIBUTION</h3>
                        <div className="flex items-end justify-around h-64 gap-8">
                            {['SAFE','MODERATE','CRITICAL'].map(level => {
                                const count = level === 'SAFE' ? stats.safe : level === 'MODERATE' ? stats.moderate : stats.critical;
                                const pct = stats.total ? (count / stats.total) * 100 : 0;
                                const color = level === 'SAFE' ? 'bg-green-500' : level === 'MODERATE' ? 'bg-yellow-500' : 'bg-red-500';
                                return (
                                    <div key={level} className="w-full flex flex-col items-center group">
                                        <div className="text-white font-mono mb-3 opacity-0 group-hover:opacity-100 transition-opacity text-lg font-bold">{count}</div>
                                        <div className={`w-full max-w-[100px] rounded-t-lg ${color} opacity-60 hover:opacity-100 chart-bar shadow-[0_0_20px_rgba(0,0,0,0.3)]`} style={{height: `${Math.max(pct,2)}%`}}></div>
                                        <div className="text-gray-400 text-sm mt-4 font-bold tracking-wider">{level}</div>
                                    </div>
                                )
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        // --- AI CHAT WIDGET ---
        const AIAssistant = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([{ role: 'ai', text: 'Greetings. I am Sentinel AI. How can I assist with your security protocols today?' }]);
            const [input, setInput] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const endRef = useRef(null);

            useEffect(() => endRef.current?.scrollIntoView({ behavior: "smooth" }), [messages]);

            const handleSend = async () => {
                if (!input.trim()) return;
                const msg = input;
                setInput('');
                setMessages(p => [...p, { role: 'user', text: msg }]);
                setIsTyping(true);
                SoundEngine.play('click');

                const aiMsg = await callGemini(`You are Sentinel AI, a cybersecurity expert. Answer concisely: "${msg}"`);
                setMessages(p => [...p, { role: 'ai', text: aiMsg }]);
                setIsTyping(false);
                SoundEngine.play('ai');
            };

            return (
                <div className="fixed bottom-6 right-6 z-50 flex flex-col items-end">
                    {isOpen && (
                        <div className="glass-panel w-96 h-[500px] mb-4 rounded-xl flex flex-col overflow-hidden animate-fade-in border-cyan-500/30 shadow-2xl">
                            <div className="bg-cyan-900/30 p-4 border-b border-cyan-500/30 flex justify-between items-center">
                                <div className="flex items-center gap-2 text-cyan-400 font-bold tracking-wider">
                                    <Icons.Bot size={20} /> SENTINEL AI
                                </div>
                                <button onClick={() => setIsOpen(false)} className="text-gray-400 hover:text-white transition-colors"><Icons.X size={18}/></button>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-black/40">
                                {messages.map((m, i) => (
                                    <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`max-w-[85%] p-3 rounded-lg text-sm ${m.role === 'user' ? 'bg-cyan-900/50 text-white border border-cyan-500/30' : 'bg-gray-800/80 text-gray-200 border border-gray-700'}`}>
                                            {m.text}
                                        </div>
                                    </div>
                                ))}
                                {isTyping && <div className="text-xs text-cyan-500 animate-pulse ml-2">Sentinel is processing...</div>}
                                <div ref={endRef} />
                            </div>
                            <div className="p-4 border-t border-gray-800 flex gap-2 bg-black/80 backdrop-blur">
                                <input 
                                    className="flex-1 bg-transparent border-none text-sm text-white focus:outline-none placeholder-gray-600"
                                    placeholder="Ask about security..."
                                    value={input}
                                    onChange={(e) => setInput(e.target.value)}
                                    onKeyDown={(e) => e.key === 'Enter' && handleSend()}
                                />
                                <button onClick={handleSend} className="text-cyan-400 hover:text-white transition-colors"><Icons.Send size={18}/></button>
                            </div>
                        </div>
                    )}
                    <button 
                        onClick={() => { setIsOpen(!isOpen); SoundEngine.play('hover'); }}
                        className="h-14 w-14 rounded-full bg-gradient-to-br from-cyan-600 to-blue-700 hover:from-cyan-500 hover:to-blue-600 flex items-center justify-center text-white shadow-[0_0_30px_rgba(0,243,255,0.4)] transition-all hover:scale-110 z-50"
                    >
                        {isOpen ? <Icons.X size={28}/> : <Icons.MessageSquare size={28}/>}
                    </button>
                </div>
            );
        };

        // --- NEW FEATURES: Settings Modal, Ticker, Phish-IQ, Graph, Deobfuscator, Sound Mixer ---

        const SettingsModal = ({ open, onClose, theme, setTheme, a11y, setA11y, soundConfig, setSoundConfig }) => {
            if (!open) return null;
            const themes = {
                'Matrix Green': { '--neon-cyan': '#00ff00', '--neon-pink':'#00ff00', '--neon-purple':'#00ff00', '--neon-green':'#00ff00', '--neon-alert':'#ff3333' },
                'Cyberpunk Yellow': { '--neon-cyan':'#ffd60a', '--neon-pink':'#ff00ff', '--neon-purple':'#ff8c00', '--neon-green':'#00ffa3', '--neon-alert':'#ff2d2d' },
                'Red Alert': { '--neon-cyan':'#ff6b6b', '--neon-pink':'#ff4757', '--neon-purple':'#ff375f', '--neon-green':'#ff6b6b', '--neon-alert':'#ff0000' }
            };

            const applyTheme = (key) => {
                const map = themes[key];
                Object.entries(map).forEach(([k,v]) => document.documentElement.style.setProperty(k, v));
                setTheme(key);
            };

            useEffect(()=>{ document.documentElement.classList.toggle('a11y-mode', !!a11y); }, [a11y]);

            return (
                <div className="fixed inset-0 z-60 flex items-center justify-center p-6">
                    <div className="absolute inset-0 bg-black/70 backdrop-blur-sm" onClick={onClose}></div>
                    <div className="glass-panel p-6 rounded-xl w-full max-w-2xl relative">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-xl font-bold">Appearance & Settings</h3>
                            <button onClick={onClose} className="text-gray-400"><Icons.X/></button>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <div className="text-xs text-gray-400 mb-2 uppercase font-bold">Theme Presets</div>
                                <div className="flex gap-2">
                                    {Object.keys(themes).map(t => (
                                        <button key={t} onClick={()=>applyTheme(t)} className={`px-3 py-2 rounded ${t===theme? 'bg-cyan-600 text-black' : 'bg-black/30 text-white'}`}>{t}</button>
                                    ))}
                                </div>
                            </div>
                            <div>
                                <div className="text-xs text-gray-400 mb-2 uppercase font-bold">Accessibility</div>
                                <label className="flex items-center gap-3">
                                    <input type="checkbox" checked={!!a11y} onChange={e=>setA11y(e.target.checked)} />
                                    <span className="text-sm">High-Contrast Mode (A11y)</span>
                                </label>
                                <div className="mt-4 text-xs text-gray-400 mb-2 uppercase font-bold">Sound Mixer</div>
                                <div className="space-y-2">
                                    {['click','alert','ai','hover'].map(k => (
                                        <label key={k} className="flex items-center justify-between bg-black/20 p-2 rounded">
                                            <span className="capitalize">{k}</span>
                                            <input type="checkbox" checked={!soundConfig[k]} onChange={e=>setSoundConfig(prev=>{ const nw={...prev}; nw[k]=!e.target.checked; SoundEngine.setMuted(k,nw[k]); localStorage.setItem('phishguard_sound_cfg', JSON.stringify(nw)); return nw; })} />
                                        </label>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const ThreatTicker = ({ items }) => {
            const list = items.slice(0,50).map(i => `${i.threatLevel}:${i.hostname}`);
            const text = list.join('  ');
            return (
                <div className="w-full bg-black/60 border-b border-cyan-900/20 py-2 text-sm text-cyan-300 overflow-hidden no-print">
                    <div style={{whiteSpace:'nowrap', display:'inline-block', paddingLeft: '100%'}} className="animate-[ticker_30s_linear_infinite]">{text}</div>
                    <style>{`@keyframes ticker{0%{transform:translateX(0%)}100%{transform:translateX(-100%)}} .animate-[ticker_30s_linear_infinite]{animation:ticker 30s linear infinite}`}</style>
                </div>
            );
        };

        const PhishIQ = ({ onClose }) => {
            const scenarios = [
                { real: 'https://www.github.com', fake: 'https://www.githb.com', correct: 'real', hint: 'Look for typosquatting'},
                { real: 'https://paypal.com', fake: 'https://paypal-secure-login.com', correct: 'real', hint: 'Brand mismatch and extra words'},
                { real: 'https://bankofamerica.com', fake: 'https://bankofarnerica.com', correct: 'real', hint: 'Homoglyphs / character replacements'}
            ];
            const [idx, setIdx] = useState(0);
            const [score, setScore] = useState(0);
            const scene = scenarios[idx % scenarios.length];
            const choose = (choice) => {
                if (choice === scene.correct) setScore(s => s+1);
                else setScore(s => Math.max(0,s-1));
                setIdx(i => i+1);
                SoundEngine.play(choice === scene.correct ? 'ai' : 'alert');
            };
            return (
                <div className="p-6 max-w-4xl mx-auto">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold">Phish-IQ Training</h2>
                        <div className="text-sm text-gray-400">Score: <span className="font-mono">{score}</span></div>
                    </div>
                    <div className="glass-panel p-6 rounded-lg">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <button onClick={()=>choose('real')} className="p-6 bg-black/40 rounded hover:bg-cyan-900/20">{scene.real}</button>
                            <button onClick={()=>choose('fake')} className="p-6 bg-black/40 rounded hover:bg-red-900/20">{scene.fake}</button>
                        </div>
                        <div className="text-xs text-gray-500 mt-4">Hint: {scene.hint}</div>
                    </div>
                    <div className="mt-4 flex gap-2">
                        <button onClick={onClose} className="px-4 py-2 rounded bg-gray-800">Close</button>
                    </div>
                </div>
            );
        };

        const VisualGraph = ({ node }) => {
            if (!node) return (
                <div className="p-6 text-gray-500">Run a scan to populate the visual threat map.</div>
            );
            const w = 700, h = 300;
            const domain = { id: 'domain', label: node.hostname, x: 100, y: h/2 };
            const ip = { id: 'ip', label: node.geo.ip, x: 300, y: h/3 };
            const isp = { id: 'isp', label: node.geo.isp || 'ISP', x: 500, y: h/3 };
            const country = { id: 'country', label: node.geo.country, x: 500, y: (2*h)/3 };
            const nodes = [domain, ip, isp, country];
            const edges = [{from:'domain',to:'ip'},{from:'ip',to:'isp'},{from:'isp',to:'country'}];
            return (
                <div className="p-6">
                    <svg width="100%" viewBox={`0 0 ${w} ${h}`} className="glass-panel p-4 rounded-lg">
                        {edges.map((e,i)=>{
                            const a = nodes.find(n=>n.id===e.from); const b = nodes.find(n=>n.id===e.to);
                            return <line key={i} x1={a.x} y1={a.y} x2={b.x} y2={b.y} stroke="rgba(0,243,255,0.3)" strokeWidth="2" />;
                        })}
                        {nodes.map(n=> (
                            <g key={n.id}>
                                <circle cx={n.x} cy={n.y} r={28} fill="rgba(0,0,0,0.6)" stroke="var(--neon-cyan)" strokeWidth="1.5" />
                                <text x={n.x} y={n.y+4} textAnchor="middle" fontSize="10" fill="#e6f7ff" fontFamily="JetBrains Mono">{n.label}</text>
                            </g>
                        ))}
                    </svg>
                </div>
            );
        };

        const URLDeobfuscator = ({ url }) => {
            const parsed = useMemo(() => {
                const r = normalizeUrl(url || '');
                if (!r.valid) return null;
                const u = new URL(r.normalized);
                const parts = { protocol: u.protocol.replace(':',''), subdomain: u.hostname.split('.').slice(0,-2).join('.') || '', root: u.hostname.split('.').slice(-2).join('.') };
                const risk = parts.subdomain.includes('secure') || /\d/.test(parts.subdomain) ? 'suspicious' : 'normal';
                return { ...parts, risk };
            }, [url]);
            if (!parsed) return <div className="p-4 text-gray-500">Enter a URL to de-obfuscate.</div>;
            return (
                <div className="p-4 glass-panel rounded-lg">
                    <div className="flex justify-between mb-2"><span className="text-xs text-gray-400">Protocol</span><span className="font-mono">{parsed.protocol}</span></div>
                    <div className="flex justify-between mb-2"><span className="text-xs text-gray-400">Subdomain</span><span className="font-mono">{parsed.subdomain || '(none)'}</span></div>
                    <div className="flex justify-between mb-2"><span className="text-xs text-gray-400">Root Domain</span><span className="font-mono">{parsed.root}</span></div>
                    <div className="flex justify-between"><span className="text-xs text-gray-400">Risk</span><span className={`${parsed.risk==='suspicious' ? 'text-red-400' : 'text-green-400'} font-bold`}>{parsed.risk}</span></div>
                </div>
            );
        };

        const SoundMixerPanel = ({ config, setConfig }) => {
            const toggle = (k) => { const nw = {...config, [k]: !config[k]}; setConfig(nw); SoundEngine.setMuted(k, nw[k]); localStorage.setItem('phishguard_sound_cfg', JSON.stringify(nw)); };
            return (
                <div className="p-4 glass-panel rounded-lg">
                    <div className="text-xs text-gray-400 mb-2 uppercase font-bold">Sound Mixer</div>
                    {['click','alert','ai','hover'].map(k => (
                        <div key={k} className="flex justify-between items-center mb-2">
                            <span className="capitalize">{k}</span>
                            <input type="checkbox" checked={!config[k]} onChange={()=>toggle(k)} />
                        </div>
                    ))}
                </div>
            );
        };

        // ==========================================
        // 6. MAIN APP ORCHESTRATOR
        // ==========================================
        const App = () => {
            const [view, setView] = useState('SCANNER');
            const [activeScan, setActiveScan] = useState(null);
            const [history, setHistory] = useState([]);
            const [showHistory, setShowHistory] = useState(false);
            const [soundEnabled, setSoundEnabled] = useState(true);
            const [isLoading, setIsLoading] = useState(false);
            const [settingsOpen, setSettingsOpen] = useState(false);
            const [theme, setTheme] = useState('Default');
            const [a11yMode, setA11yMode] = useState(false);
            const [showPhishIQ, setShowPhishIQ] = useState(false);
            const [soundConfig, setSoundConfig] = useState(() => {
                try { return JSON.parse(localStorage.getItem('phishguard_sound_cfg') || '{}'); } catch(e){ return {}; }
            });
            const searchRef = useRef(null);

            useEffect(() => {
                try {
                    const saved = localStorage.getItem('phishguard_ultimate_history');
                    if (saved) setHistory(JSON.parse(saved));
                } catch(e) {}
            }, []);

            useEffect(() => {
                try { localStorage.setItem('phishguard_ultimate_history', JSON.stringify(history)); } catch(e) {}
            }, [history]);

            useEffect(() => {
                SoundEngine.enabled = soundEnabled;
                if (soundEnabled) SoundEngine.init();
            }, [soundEnabled]);

            // Apply saved sound config
            useEffect(()=>{
                Object.entries(soundConfig || {}).forEach(([k,v]) => SoundEngine.setMuted(k, v));
            }, []);

            // Keyboard shortcuts
            useEffect(()=>{
                const onKey = (e) => {
                    if (e.key === 'k' && (e.ctrlKey || e.metaKey)) { e.preventDefault(); searchRef.current?.focus(); }
                    if (e.key === 'b' && (e.ctrlKey || e.metaKey)) { e.preventDefault(); setView('BATCH'); }
                    if (e.key === 'Escape') { setSettingsOpen(false); setShowHistory(false); setShowPhishIQ(false); }
                };
                window.addEventListener('keydown', onKey);
                return ()=>window.removeEventListener('keydown', onKey);
            }, []);

            const handleScan = async (url) => {
                const target = (url || '').trim();
                if (!target) return;

                // Check allow/block lists
                const host = (normalizeUrl(target).hostname || '').replace(/^www\./,'');
                const allow = Lists.getAllow();
                const block = Lists.getBlock();
                if (block.includes(host)) { alert('This host is in your blocklist. Aborting scan.'); return; }
                if (allow.includes(host)) { alert('This host is in your allowlist. Skipping deep scan. Showing cached info.'); const cached = history.find(h=>h.hostname===host); if (cached) { setActiveScan(cached); setView('RESULTS'); return; } }

                setIsLoading(true);
                SoundEngine.play('scan');
                
                try {
                    const result = await PhishGuardService.analyze(target);
                    setActiveScan(result);
                    setHistory(p => [result, ...p].slice(0, 100));
                    setView('RESULTS');
                    if (result.threatLevel === 'CRITICAL') SoundEngine.play('alert');
                    else SoundEngine.play('click');
                } catch (e) {
                    console.error(e);
                } finally {
                    setIsLoading(false);
                }
            };

            const renderContent = () => {
                if (isLoading) return (
                    <div className="flex flex-col items-center justify-center h-full">
                        <div className="relative w-24 h-24 mb-8">
                            <div className="absolute inset-0 border-4 border-cyan-900 border-t-cyan-400 rounded-full animate-spin"></div>
                            <div className="absolute inset-4 border-4 border-purple-900 border-b-purple-500 rounded-full animate-spin" style={{animationDirection:'reverse'}}></div>
                        </div>
                        <div className="font-mono text-cyan-400 animate-pulse tracking-[0.2em] text-xl">ANALYZING VECTORS...</div>
                    </div>
                );

                switch(view) {
                    case 'RESULTS': return <ResultDetail data={activeScan} onBack={() => setView('SCANNER')} />;
                    case 'EMAIL': return <EmailAnalyzer />;
                    case 'BATCH': return <BatchScanner onScanComplete={r => setHistory(p => [r, ...p])} />;
                    case 'ANALYTICS': return <AnalyticsDashboard history={history} />;
                    case 'GRAPH': return <VisualGraph node={activeScan} />;
                    case 'DEOBF': return <div className="p-6 max-w-4xl"><URLDeobfuscator url={activeScan?.url || ''} /></div>;
                    case 'TRAIN': return <PhishIQ onClose={()=>setView('SCANNER')} />;
                    case 'SCANNER': default: return <ScannerHome searchRef={searchRef} onScan={handleScan} />;
                }
            };

            return (
                <div className="flex min-h-screen relative overflow-hidden">
                    <div className="cyber-grid"></div>
                    
                    {/* Sidebar */}
                    <aside className="w-20 md:w-72 border-r border-cyan-900/30 bg-black/60 backdrop-blur-md flex flex-col z-40 fixed h-full transition-all duration-300">
                        <div className="p-6 flex items-center gap-4 border-b border-cyan-900/30">
                            <Icons.Shield className="text-cyan-400 shrink-0 drop-shadow-[0_0_10px_rgba(0,243,255,0.5)]" size={36} />
                            <div className="hidden md:block">
                                <h1 className="font-bold text-2xl tracking-tighter text-white">PHISH<span className="text-cyan-400">GUARD</span></h1>
                                <div className="text-[10px] text-fuchsia-500 tracking-[0.3em] font-bold">ULTIMATE</div>
                            </div>
                        </div>

                        <nav className="flex-1 py-6 space-y-2">
                            <NavItem icon={Icons.Search} label="URL Scanner" active={view === 'SCANNER' || view === 'RESULTS'} onClick={() => { setView('SCANNER'); SoundEngine.play('hover'); }} />
                            <NavItem icon={Icons.Mail} label="Email Analyzer" active={view === 'EMAIL'} onClick={() => { setView('EMAIL'); SoundEngine.play('hover'); }} />
                            <NavItem icon={Icons.FileText} label="Batch Processing" active={view === 'BATCH'} onClick={() => { setView('BATCH'); SoundEngine.play('hover'); }} />
                            <NavItem icon={Icons.BarChart3} label="Threat Analytics" active={view === 'ANALYTICS'} onClick={() => { setView('ANALYTICS'); SoundEngine.play('hover'); }} />
                            <NavItem icon={Icons.Sparkles} label="Phish-IQ" active={view === 'TRAIN'} onClick={() => { setView('TRAIN'); SoundEngine.play('hover'); }} />
                            <NavItem icon={Icons.MapPin} label="Threat Map" active={view === 'GRAPH'} onClick={() => { setView('GRAPH'); SoundEngine.play('hover'); }} />
                            <NavItem icon={Icons.Globe} label="De-Obfuscator" active={view === 'DEOBF'} onClick={() => { setView('DEOBF'); SoundEngine.play('hover'); }} />
                        </nav>

                        <div className="p-6 border-t border-cyan-900/30 hidden md:block bg-black/20">
                            <div className="flex justify-between items-center mb-4 text-xs text-gray-500 font-bold tracking-wider">
                                <span>SYSTEM</span>
                                <div className="flex items-center gap-2">
                                    <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                    <span className="text-green-500">ONLINE</span>
                                </div>
                            </div>
                            <div className="text-[10px] text-gray-600 font-mono leading-relaxed mb-3">
                                ENGINE: v4.2.0<br/>
                                NODE: US-EAST-1<br/>
                                SECURE: TLS 1.3
                            </div>
                            <button onClick={()=>setSettingsOpen(true)} className="w-full py-2 rounded bg-cyan-800 text-white mb-2">Settings</button>
                            <SoundMixerPanel config={{...{click:false,alert:false,ai:false,hover:false},...soundConfig}} setConfig={setSoundConfig} />
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="flex-1 ml-20 md:ml-72 relative z-10 flex flex-col min-h-screen">
                        {/* Top Bar */}
                        <header className="h-20 border-b border-cyan-900/30 flex items-center justify-between px-8 bg-black/40 backdrop-blur sticky top-0 z-30">
                            <div className="text-xs text-cyan-600 font-mono tracking-widest hidden sm:block">
                                {new Date().toLocaleDateString()} // SESSION_ID: {Math.floor(Math.random()*999999)}
                            </div>
                            <div className="flex items-center gap-4">
                                <button 
                                    onClick={() => { setSoundEnabled(!soundEnabled); SoundEngine.play('click'); }}
                                    className={`p-2 rounded border transition-all ${soundEnabled ? 'border-cyan-500 text-cyan-400 bg-cyan-900/20' : 'border-gray-700 text-gray-500'}`}
                                    title="Toggle Sound"
                                >
                                    {soundEnabled ? <Icons.Volume2 size={20}/> : <Icons.VolumeX size={20}/>}
                                </button>
                                <button 
                                    onClick={() => { setShowHistory(true); SoundEngine.play('click'); }}
                                    className="flex items-center gap-2 px-4 py-2 border border-cyan-900/50 rounded text-cyan-400 hover:bg-cyan-900/20 transition-all"
                                >
                                    <Icons.Activity size={20}/>
                                    <span className="hidden sm:inline font-bold text-sm">LOGS</span>
                                </button>
                            </div>
                        </header>

                        <ThreatTicker items={history} />

                        <div className="flex-1 relative">
                            {renderContent()}
                        </div>
                    </main>

                    {/* History Drawer */}
                    <div className={`fixed inset-y-0 right-0 w-96 bg-[#080808] border-l border-cyan-900/50 z-50 transform transition-transform duration-300 ease-out shadow-[-20px_0_50px_rgba(0,0,0,0.8)] ${showHistory ? 'translate-x-0' : 'translate-x-full'}`}>
                        <div className="p-6 h-full flex flex-col">
                            <div className="flex justify-between items-center mb-8">
                                <h2 className="text-2xl font-bold text-white flex items-center gap-3"><Icons.Clock size={24} className="text-cyan-400"/> SCAN HISTORY</h2>
                                <button onClick={() => setShowHistory(false)} className="text-gray-500 hover:text-white transition-colors"><Icons.X size={24}/></button>
                            </div>
                            
                            <div className="flex-1 overflow-y-auto space-y-3 pr-2">
                                {history.length === 0 && (
                                    <div className="text-center text-gray-600 mt-20">
                                        <Icons.FileText size={48} className="mx-auto mb-4 opacity-20"/>
                                        <p>No scans recorded in this session.</p>
                                    </div>
                                )}
                                {history.map((item, idx) => (
                                    <div 
                                        key={item.id || idx} 
                                        className="bg-gray-900/50 p-4 rounded-lg border border-gray-800 hover:border-cyan-500/50 cursor-pointer group transition-all hover:bg-gray-800"
                                        onClick={() => { setActiveScan(item); setView('RESULTS'); setShowHistory(false); SoundEngine.play('click'); }}
                                    >
                                        <div className="flex justify-between items-start mb-2">
                                            <span className="text-cyan-400 font-mono text-xs truncate w-48">{item.hostname}</span>
                                            <span className="text-[10px] text-gray-600">{new Date(item.timestamp).toLocaleTimeString()}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <div className={`text-xs font-bold px-2 py-1 rounded ${item.threatLevel === 'CRITICAL' ? 'bg-red-900/30 text-red-500' : item.threatLevel === 'MODERATE' ? 'bg-yellow-900/30 text-yellow-500' : 'bg-green-900/30 text-green-500'}`}>
                                                {item.threatLevel}
                                            </div>
                                            <div className="flex gap-2 items-center">
                                                <button onClick={(e)=>{ e.stopPropagation(); Lists.addAllow(item.hostname.replace(/^www\./,'')); alert('Added to allowlist'); }} className="text-xs px-2 py-1 border rounded text-green-400">Allow</button>
                                                <button onClick={(e)=>{ e.stopPropagation(); Lists.addBlock(item.hostname.replace(/^www\./,'')); alert('Added to blocklist'); }} className="text-xs px-2 py-1 border rounded text-red-400">Block</button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            {history.length > 0 && (
                                <button 
                                    onClick={() => { if(confirm('Clear logs?')) setHistory([]); SoundEngine.play('click'); }}
                                    className="mt-6 w-full py-3 border border-red-900/30 text-red-500 hover:bg-red-900/10 rounded font-bold tracking-wider transition-all"
                                >
                                    PURGE LOGS
                                </button>
                            )}
                        </div>
                    </div>

                    <SettingsModal open={settingsOpen} onClose={()=>setSettingsOpen(false)} theme={theme} setTheme={setTheme} a11y={a11yMode} setA11y={setA11yMode} soundConfig={soundConfig} setSoundConfig={setSoundConfig} />
                    <AIAssistant />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <ErrorBoundary>
                <App />
            </ErrorBoundary>
        );
    </script>
</body>
</html>